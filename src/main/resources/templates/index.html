<!DOCTYPE HTML>
<html>
<head>
    <title>todo list</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script type="text/javascript"	th:src="${urls.getForLookupPath('/jquery-2.1.1/jquery.min.js')}" charset="utf-8"></script>
	<script type="text/javascript"	th:src="${urls.getForLookupPath('/jquery-easyui-1.5.1/jquery.easyui.min.js')}" charset="utf-8"></script>
	<script type="text/javascript"	th:src="${urls.getForLookupPath('/jquery-easyui-1.5.1/locale/easyui-lang-zh_CN.js')}"	charset="utf-8"></script>
	<link rel="stylesheet" type="text/css"	th:href="${urls.getForLookupPath('/jquery-easyui-1.5.1/themes/gray/easyui.css')}" />
	<link rel="stylesheet" type="text/css"	th:href="${urls.getForLookupPath('/jquery-easyui-1.5.1/themes/icon.css')}" />
<script type="text/javascript">
/*<![CDATA[*/
$.extend($.fn.validatebox.defaults.rules, {
    unnull: {
        validator: function(value, param){
            value = value.replace(/(^\s*)|(\s*$)/g, "");
            if (value != null && value != "") {
                return true;
            }
            return false;
        },
        message: '请输入至少{0}个非空格字符。'
    },
    checkFolderName: {
        validator: function(value, param){
    		var tempobj={};
    		tempobj[param[1]]=value;
    		tempobj[param[2]]=$(param[3]).val();
    		var result=$.ajax({url:param[0],dataType:"json",data:tempobj,async:false,cache:false,type:"post"}).responseText;
    		return result=="true";
    	},
        message: '同路径下已经存在同名文件夹。'
    }
});
/*]]>*/
</script>
</head>
<body id="selfBody" class="easyui-layout">

<div data-options="region:'north',border:false" style="height:60px;background:#B3DFDA;padding:10px">
	<a href="#" id="shutdownBtn" >关闭服务</a>
</div>
<div data-options="region:'west',split:true,title:'West',border:false" style="width:200px;padding:1px;">
<div class="easyui-panel" title=" " style="width:100%;padding:0px;" data-options="closable:false,tools:'#tt'">
<a href="#" class="easyui-linkbutton" style="border:0px;border-radius:0px;width:100%" >最新的文档</a>
<a href="#" class="easyui-linkbutton" style="border:0px;border-radius:0px;width:100%;" onclick="showFolderTree();" >我的文件夹</a>
<ul id="tfolder"></ul>
<a href="#" class="easyui-linkbutton" style="border:0px;border-radius:0px;width:100%;" >垃圾箱</a>

</div>
<div id="tt">
	<a href="javascript:void(0)" class="icon-add" onclick="javascript:addRootFolder();"></a><!-- alert('添加顶级文件夹') -->
	<a href="javascript:void(0)" class="icon-reload" onclick="javascript:reloadFolder();"></a>
	<!-- a href="javascript:void(0)" class="icon-remove" onclick="javascript:alert('删除顶级文件夹')"></a -->
	<!--
	<a href="javascript:void(0)" class="icon-edit" onclick="javascript:alert('edit')"></a>
	<a href="javascript:void(0)" class="icon-cut" onclick="javascript:alert('cut')"></a>
	<a href="javascript:void(0)" class="icon-help" onclick="javascript:alert('help')"></a>
	-->
</div>
</div>
<div data-options="region:'east',split:true,title:'East',border:false" style="width:60%;padding:10px;">east region</div><!-- ,collapsed:true -->
<div data-options="region:'south',border:false" style="height:50px;background:#A9FACD;padding:10px;">south region</div>
<div data-options="region:'center',title:'Center',border:false">
	<input id="searchText" type="text" class="easyui-textbox" data-options="buttonText:'查询',prompt:'Search...'" style="border-radius:0px;width:100%;height:32px;" />
</div>

<div id="mm" class="easyui-menu" style="width:120px;">
	<div onclick="addChildFolder()" data-options="iconCls:'icon-add'">添加子文件夹</div>
	<div onclick="deleteFolder()" data-options="iconCls:'icon-remove'">删除文件夹</div>
	<div onclick="updateFolder()" data-options="iconCls:'icon-edit'">文件夹改名</div>
	<div onclick="addlog()" data-options="iconCls:'icon-help'">添加记录</div>
</div>

<div id="mm2" style="width:100px;">
	<div>Help</div>
	<div>Update</div>
	<div>About</div>
</div>
<div id="dlgAddFolder" class="easyui-dialog" title="" style="width:400px;height:200px;padding:10px"
data-options="
    iconCls: 'icon-save',
    buttons: [{
        text:'确定',
        handler:function(){
            $.messager.progress();
        	$('#addFolderForm').form('submit', {
        		url: $('#addFolderForm').attr('action'),
        		onSubmit: function(){
        			var isValid = $(this).form('validate');
        			if (!isValid){
        				$.messager.progress('close');
        			}
        			return isValid;
        		},
        		success: function(){
        			$.messager.progress('close');
        			$('#dlgAddFolder').dialog('close');
		            if ( $('#addFolderType').val() == 'root') {
        				$('#tfolder').tree('reload');
        			} else if ( $('#addFolderType').val() == 'child') {
        				$('#tfolder').tree('reload', $('#tfolder').tree('getSelected').target);
        			} else if ( $('#addFolderType').val() == 'update') {
        				var node = $('#tfolder').tree('getSelected');
						if (node){
							$('#tfolder').tree('update', {
								target: node.target,
								text: $('#folderName').val()
							});
						}
        			}
        			$('#addFolderForm').form('reset');
		            $('#addFolderForm').form('clear');
        		}
        	});
        }
    },{
        text:'取消',
        handler:function(){
            $('#dlgAddFolder').dialog('close');
            $('#addFolderForm').form('reset');
            $('#addFolderForm').form('clear');
        }
    }],
    modal:true,
    closed: true
">
<form id="addFolderForm" action="/addNewFolder" method="post" enctype="multipart/form-data">
<input class="easyui-textbox" id="folderName" name="folderName" style="width:100%" 
       data-options="label:'folderName:',invalidMessage:'文件夹名必须非空且不能重复。',required:true,validType:{ unnull:[1], checkFolderName:['/checkFolderExistsOrNot','folderName','id','#newFolderId'] }" />
<input type="hidden" id="newFolderId" name="id" value="" />
<input type="hidden" id="addFolderType" name="folderType" value="" />
</form>
</div>


<script type="text/javascript" >
function reloadFolder() {
	$('#tfolder').tree('reload');
}

function showFolderTree(){
	if (!$('#tfolder').attr("style")) {
		$('#tfolder').attr("style","display:none");
	} else if ($('#tfolder').attr("style") == 'display:none') {
		$('#tfolder').attr("style","display:block");
	} else if ($('#tfolder').attr("style") == 'display:block') {
		$('#tfolder').attr("style","display:none");
	}
}

function addRootFolder() {
	$('#dlgAddFolder').dialog({'title':'添加顶级文件夹'});
	$('#addFolderForm').attr("action", "/addNewFolder");
	$('#newFolderId').val('0');
	$('#addFolderType').val('root');
	$('#dlgAddFolder').dialog('open');
	$('#folderName').next('span').find('input').focus();
}
function addChildFolder() {
	$('#dlgAddFolder').dialog({'title':'添加子级文件夹'});
	$('#addFolderForm').attr("action", "/addNewFolder");
	$('#newFolderId').val($('#tfolder').tree('getSelected').id);
	$('#addFolderType').val('child');
	$('#dlgAddFolder').dialog('open');
	$('#folderName').next('span').find('input').focus();
}
function deleteFolder() {
	var id = $('#tfolder').tree('getSelected').id;
	if (1 == id || 2 == id || 3 == id) {
		$.messager.alert('系统信息','此文件夹不能删除！','info');
		return;
	}
	$.messager.confirm('删除文件夹', '确定要删除此文件夹吗？', function(r){
        if (r){
        	$.ajax({
        		type: 'POST',
        		url: '/deleteFolder',
        		data: {'id': $('#tfolder').tree('getSelected').id },
        		dataType: 'json',
        		success: function(data, textStatus){
        			if (true == data) {
	        			$('#tfolder').tree('reload', $('#tfolder').tree('getParent', $('#tfolder').tree('getSelected').target).target);
	        			$.messager.show({
	        				title:'系统信息',
	        				msg:'删除文件夹成功！',
	        				showSpeed:100,
	        				showType:'fade',
	        				timeout:400,
	        				style:{
	        					right:'',
	        					bottom:''
	        				}
	        			});
        			} else {
        				$.messager.show({
	        				title:'系统信息',
	        				msg:'删除文件夹失败！',
	        				showSpeed:100,
	        				showType:'fade',
	        				timeout:400,
	        				style:{
	        					right:'',
	        					bottom:''
	        				}
	        			});
        			}
        		}
        	});
        }
    });
}
function updateFolder() {
	$('#dlgAddFolder').dialog({'title':'修改文件夹名称'});
	$('#addFolderForm').attr("action", "/updateFolderName");
	$('#newFolderId').val($('#tfolder').tree('getSelected').id);
	$('#addFolderType').val('update');
	$('#dlgAddFolder').dialog('open');
	$('#folderName').next('span').find('input').focus();
}
$(document).ready(function(){
	//捕捉链接的点击事件  
	$('#shutdownBtn').click(function(){
		$.ajax({
			type: 'POST',
			url: '/shutdown',
			dataType: 'json',
			success: function(data, textStatus){
				$.messager.show({
    				title:'系统信息',
    				msg:'关闭成功！',
    				showSpeed:100,
    				showType:'fade',
    				timeout:400,
    				style:{
    					right:'',
    					bottom:''
    				}
    			});
			}
		});
	});
	
	$('#tfolder').tree({
	    url: "/getFolders",
	    formatter:function(node){
			return node.text;
		},
		onClick: function(node) {
			alert(node.text);
		},
		onContextMenu: function(e, node){
			e.preventDefault();
			// select the node
			$('#tfolder').tree('select', node.target);
			// display context menu
			$('#mm').menu('show', {
				left: e.pageX,
				top: e.pageY
			});
		}
	});
	
	
});

</script>
</body>
</html>